#! /usr/bin/env bash

# Constants 
LUA_VERSIONS_DIR=/Users/zcfrank1st/Downloads/lua-versions
LUA_VERSIONS="5.1;5.2"
#

# Check version
LVM_VERSION=`cat $LUA_VERSIONS_DIR/LVM_VERSION`
REPO_LVM_VERSION=`curl https://raw.githubusercontent.com/zcfrank1st/lvm/master/LVM_VERSION`
if [[ $LVM_VERSION != $REPO_LVM_VERSION ]]
then
  echo "A new version is applyed, please use 'lvm -l' to update lvm"
  exit 0
fi

# Common
usage(){
cat << EOF
Usage: lvm [-hvl] [-u VERSION]
    -h          display the help and exit
    -v          show current lvm version
    -u VERSION  choose lua verison to use, as lvm -u 5.1
    -l          level up lvm
    -s          show current contained lua versions
EOF
}

version(){
    echo "lvm current version : "$LVM_VERSION
}

while getopts "hvlu:" opt; do
    case "$opt" in
        h)
            usage
            exit 0
            ;;
        v)  
            version
            exit 0
            ;;
        l)  
            # level up lvm
            ;;
        s)
            echo $LUA_VERSIONS
        u)
            pverison=$OPTARG
            ln -f $LUA_VERSIONS_DIR/libs/lua$pversion /usr/local/bin/lua
            ln -f $LUA_VERSIONS_DIR/libs/luac$pversion /usr/local/bin/luac
            exit 0
            ;;
        '?')
            usage >&2
            exit 1
            ;;
     esac
done
